// maze.html
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Maze</title>
<style>
  :root{--glass:rgba(255,255,255,.2);--shadow:rgba(0,0,0,.35);}
  html,body{height:100%;margin:0;background:
    radial-gradient(circle at 20% 10%, #e9feff 0%, #9befff 30%, #5cc9ff 60%, #2b84ff 100%);
    font-family:"Trebuchet MS","Segoe UI",sans-serif;color:#e9f7ff;display:flex;align-items:center;justify-content:center;}
  .panel{width:min(520px,94vw);padding:14px;border-radius:22px;background:var(--glass);
    backdrop-filter:blur(14px);box-shadow:0 18px 40px var(--shadow);}
  canvas{width:100%;height:auto;border-radius:18px;background:rgba(0,0,0,.2);}
  .row{display:flex;gap:10px;justify-content:center;margin-top:8px;}
  .btn{min-height:48px;padding:10px 14px;border-radius:18px;border:none;color:#07304f;
    background:linear-gradient(#fff,#b8f6ff,#5bc9ff);box-shadow:0 8px 16px rgba(0,0,0,.25);font-weight:700;}
</style>
</head>
<body>
<div class="panel">
  <canvas id="c" width="420" height="420"></canvas>
  <div class="row"><button class="btn" id="next">Next Level</button></div>
</div>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const c=document.getElementById('c'); const ctx=c.getContext('2d');
  let level=Number(localStorage.getItem('mazeLevel')||1);
  let size=10+level;
  let maze, player={x:0,y:0};

  function gen(){
    size=10+level;
    const w=size,h=size;
    maze=Array.from({length:h},()=>Array.from({length:w},()=>({v:false,w:[1,1,1,1]})));
    const stack=[[0,0]]; maze[0][0].v=true;
    while(stack.length){
      const [x,y]=stack[stack.length-1];
      const dirs=[[0,-1,0,2],[1,0,1,3],[0,1,2,0],[-1,0,3,1]].filter(([dx,dy])=>{
        const nx=x+dx,ny=y+dy; return nx>=0&&ny>=0&&nx<w&&ny<h&&!maze[ny][nx].v;
      });
      if(dirs.length){
        const [dx,dy,wa,wb]=dirs[Math.floor(Math.random()*dirs.length)];
        const nx=x+dx,ny=y+dy;
        maze[y][x].w[wa]=0; maze[ny][nx].w[wb]=0;
        maze[ny][nx].v=true; stack.push([nx,ny]);
      }else stack.pop();
    }
    player={x:0,y:0};
  }

  let joy={x:0,y:0};
  c.addEventListener('pointermove',e=>{
    const r=c.getBoundingClientRect();
    const x=(e.clientX-r.left)/r.width*2-1;
    const y=(e.clientY-r.top)/r.height*2-1;
    joy={x,y};
  });

  function step(){
    const cell=420/size;
    const px=player.x*cell+cell/2;
    const py=player.y*cell+cell/2;
    const dx=Math.abs(joy.x)>0.2?Math.sign(joy.x):0;
    const dy=Math.abs(joy.y)>0.2?Math.sign(joy.y):0;
    if(dx||dy){
      const nx=player.x+dx, ny=player.y+dy;
      if(nx>=0&&ny>=0&&nx<size&&ny<size){
        if(dx===1 && maze[player.y][player.x].w[1]===0) player.x++;
        if(dx===-1 && maze[player.y][player.x].w[3]===0) player.x--;
        if(dy===1 && maze[player.y][player.x].w[2]===0) player.y++;
        if(dy===-1 && maze[player.y][player.x].w[0]===0) player.y--;
      }
    }
  }

  function draw(){
    const cell=420/size;
    ctx.clearRect(0,0,420,420);
    ctx.strokeStyle='rgba(255,255,255,0.8)';
    for(let y=0;y<size;y++)for(let x=0;x<size;x++){
      const w=maze[y][x].w;
      const sx=x*cell, sy=y*cell;
      if(w[0]){ctx.beginPath();ctx.moveTo(sx,sy);ctx.lineTo(sx+cell,sy);ctx.stroke();}
      if(w[1]){ctx.beginPath();ctx.moveTo(sx+cell,sy);ctx.lineTo(sx+cell,sy+cell);ctx.stroke();}
      if(w[2]){ctx.beginPath();ctx.moveTo(sx,sy+cell);ctx.lineTo(sx+cell,sy+cell);ctx.stroke();}
      if(w[3]){ctx.beginPath();ctx.moveTo(sx,sy);ctx.lineTo(sx,sy+cell);ctx.stroke();}
    }
    ctx.fillStyle='#7fefff';
    ctx.beginPath();ctx.arc(player.x*cell+cell/2,player.y*cell+cell/2,cell*0.25,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#7fff9a';
    ctx.fillRect((size-1)*cell+cell*0.25,(size-1)*cell+cell*0.25,cell*0.5,cell*0.5);
    if(player.x===size-1 && player.y===size-1){
      level++; localStorage.setItem('mazeLevel',level); gen();
    }
    requestAnimationFrame(draw);
  }
  gen(); requestAnimationFrame(draw);

  document.getElementById('next').addEventListener('pointerdown',()=>{
    level++; localStorage.setItem('mazeLevel',level); gen();
  });
});
</script>
</body>
</html>
